<div class="search-container">
  <mat-card class="search-card">
    <mat-card-header>
      <mat-card-title>Product Search System</mat-card-title>
      <mat-card-subtitle>Search through 1M+ products - DataCorp Solutions</mat-card-subtitle>
    </mat-card-header>

    <mat-card-content>
      <!-- Upload Section -->
      <div class="upload-section">
        <input
          #fileInput
          type="file"
          accept=".csv,.tsv,.txt"
          (change)="onFileSelected($event)"
          style="display: none">

        <button
          mat-raised-button
          color="primary"
          (click)="fileInput.click()"
          [disabled]="uploading">
          <mat-icon>upload_file</mat-icon>
          {{ uploading ? 'Uploading...' : 'Upload CSV File' }}
        </button>

        <span *ngIf="selectedFile" class="file-name">
          {{ selectedFile.name }} ({{ formatFileSize(selectedFile.size) }})
        </span>

        <button
          *ngIf="selectedFile"
          mat-raised-button
          color="accent"
          (click)="uploadFile()"
          [disabled]="uploading">
          <mat-icon>cloud_upload</mat-icon>
          Import Data
        </button>

        <div *ngIf="uploadProgress" class="upload-progress">
          <mat-progress-bar mode="indeterminate" *ngIf="uploading"></mat-progress-bar>
          <p [class.success]="uploadSuccess" [class.error]="!uploadSuccess">
            {{ uploadMessage }}
          </p>
        </div>
      </div>

      <mat-divider></mat-divider>

      <div class="search-input-wrapper">
        <mat-form-field class="search-field" appearance="outline">
          <mat-label>Search products...</mat-label>
          <input
            matInput
            [(ngModel)]="searchQuery"
            (input)="onSearchInput()"
            (keyup.enter)="onSearch()"
            placeholder="Try: Silla, NovaHome, Laptop, TECHPR..."
            [matAutocomplete]="auto">
          <button
            mat-icon-button
            matSuffix
            *ngIf="searchQuery"
            (click)="clearSearch()">
            <mat-icon>clear</mat-icon>
          </button>
          <button
            mat-icon-button
            matSuffix
            (click)="onSearch()">
            <mat-icon>search</mat-icon>
          </button>
        </mat-form-field>

        <mat-autocomplete #auto="matAutocomplete">
          <mat-option
            *ngFor="let suggestion of suggestions"
            [value]="suggestion"
            (click)="onSuggestionClick(suggestion)">
            <mat-icon>search</mat-icon>
            {{ suggestion }}
          </mat-option>
        </mat-autocomplete>
      </div>

      <div class="filter-bar" *ngIf="products.length > 0">
        <mat-chip-set>
          <mat-chip
            *ngFor="let filter of activeFilters"
            (removed)="removeFilter(filter)">
            {{ filter }}
            <mat-icon matChipRemove>cancel</mat-icon>
          </mat-chip>
        </mat-chip-set>
      </div>

      <div class="results-info" *ngIf="total > 0 && !loading">
        <mat-chip-set>
          <mat-chip>
            <mat-icon>inventory_2</mat-icon>
            {{ total | number }} products
          </mat-chip>
          <mat-chip>
            <mat-icon>pages</mat-icon>
            Page {{ page }} of {{ totalPages }}
          </mat-chip>
        </mat-chip-set>
      </div>

      <div class="loading-spinner" *ngIf="loading">
        <mat-spinner diameter="50"></mat-spinner>
        <p>Searching products...</p>
      </div>

      <div class="products-grid" *ngIf="!loading && products.length > 0">
        <mat-card class="product-card" *ngFor="let product of products">
          <mat-card-header>
            <mat-card-title class="product-title" [title]="product.title">
              {{ product.title }}
            </mat-card-title>
            <mat-card-subtitle>
              <strong>{{ product.brand }}</strong>
            </mat-card-subtitle>
          </mat-card-header>

          <mat-card-content>
            <div class="product-details">
              <div class="detail-row">
                <mat-icon>category</mat-icon>
                <span>{{ product.category }}</span>
              </div>

              <div class="detail-row">
                <mat-icon>label</mat-icon>
                <span>{{ product.product_type }}</span>
              </div>

              <div class="detail-row">
                <mat-icon>qr_code</mat-icon>
                <span class="sku">{{ product.sku }}</span>
              </div>

              <div class="detail-row price-row">
                <mat-icon>payments</mat-icon>
                <span class="price">{{ product.price | number:'1.2-2' }} {{ product.currency }}</span>
              </div>

              <div class="detail-row rating-row" *ngIf="product.rating">
                <mat-icon [class.high-rating]="product.rating >= 4.5">star</mat-icon>
                <span>{{ product.rating | number:'1.1-2' }} / 5.0</span>
              </div>

              <div class="detail-row stock-row" *ngIf="product.stock !== undefined" [class.low-stock]="product.stock < 10">
                <mat-icon>inventory</mat-icon>
                <span>{{ product.stock }} in stock</span>
              </div>
            </div>

            <div class="product-description" *ngIf="product.description">
              <p>{{ product.description | slice:0:120 }}{{ product.description.length > 120 ? '...' : '' }}</p>
            </div>
          </mat-card-content>

          <mat-card-actions>
            <button mat-button color="primary">
              <mat-icon>visibility</mat-icon>
              View Details
            </button>
          </mat-card-actions>
        </mat-card>
      </div>

      <div class="no-results" *ngIf="!loading && searchQuery && products.length === 0">
        <mat-icon>search_off</mat-icon>
        <h3>No products found</h3>
        <p>Try different search terms like brand names (NovaHome, TechPro), categories (Hogar, Electr√≥nica), or product types</p>
      </div>

      <mat-paginator
        *ngIf="!loading && products.length > 0"
        [length]="total"
        [pageSize]="limit"
        [pageIndex]="page - 1"
        [pageSizeOptions]="[10, 20, 50, 100]"
        (page)="onPageChange($event)"
        showFirstLastButtons>
      </mat-paginator>
    </mat-card-content>
  </mat-card>
</div>
